{% extends 'base.html' %}
{% load static %}

{% block title %}Settings - AI Stylist{% endblock %}

{% block extra_head %}
<style>
    .settings-container {
        max-width: 1000px;
        margin: 0 auto;
    }
    
    .settings-card {
        background: #ffffff;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
    }
    
    .settings-header {
        background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 12px 12px 0 0;
        margin-bottom: 0;
    }
    
    .settings-body {
        padding: 2rem;
    }
    
    .form-section {
        margin-bottom: 2rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .form-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }
    
    .section-title {
        color: #1e293b;
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
    }
    
    .section-title i {
        margin-right: 0.5rem;
        color: #2563eb;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        font-weight: 500;
        color: #374151;
        margin-bottom: 0.5rem;
    }
    
    .form-control, .form-select {
        background-color: #ffffff;
        color: #1e293b;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 0.75rem;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: #2563eb;
        box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.25);
    }
    
    .checkbox-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 0.75rem;
        margin-top: 0.75rem;
    }
    
    .form-check {
        display: flex;
        align-items: center;
        padding: 0.75rem;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        margin-bottom: 0.5rem;
        transition: all 0.2s ease;
    }
    
    .form-check:hover {
        background: #f1f5f9;
        border-color: #cbd5e1;
    }
    
    .form-check-input {
        margin-right: 1rem !important;
        margin-top: 0;
        margin-bottom: 0;
        flex-shrink: 0;
    }
    
    .form-check-label {
        margin-bottom: 0;
        font-weight: 500;
        color: #374151;
        cursor: pointer;
        flex: 1;
        line-height: 1.4;
    }
    
    /* Ensure checkbox and label are properly aligned */
    .form-check-input[type="checkbox"] {
        width: 1.1rem;
        height: 1.1rem;
        border-radius: 0.25rem;
        border: 2px solid #d1d5db;
        background-color: #ffffff;
    }
    
    .form-check-input[type="checkbox"]:checked {
        background-color: #2563eb;
        border-color: #2563eb;
    }
    
    .form-check-input[type="checkbox"]:focus {
        box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.25);
        border-color: #2563eb;
    }
    
    .btn-save {
        background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        border: none;
        color: white;
        padding: 0.75rem 2rem;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    
    .btn-save:hover {
        background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
        color: white;
    }
    
    .btn-danger {
        background: #ef4444;
        border: none;
        color: white;
        padding: 0.75rem 2rem;
        border-radius: 8px;
        font-weight: 500;
    }
    
    .btn-danger:hover {
        background: #dc2626;
        color: white;
    }
    
    .account-info {
        background: #f8fafc;
        padding: 1.5rem;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }
    
    .info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .info-item:last-child {
        border-bottom: none;
    }
    
    .info-label {
        font-weight: 500;
        color: #374151;
    }
    
    .info-value {
        color: #6b7280;
    }
    
    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 500;
    }
    
    .status-verified {
        background: #d1fae5;
        color: #065f46;
    }
    
    .status-unverified {
        background: #fef3c7;
        color: #92400e;
    }
    
    .password-strength {
        margin-top: 0.5rem;
        font-size: 0.875rem;
    }
    
    .strength-weak { color: #ef4444; }
    .strength-medium { color: #f59e0b; }
    .strength-strong { color: #10b981; }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="settings-container">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="h2 mb-1">Account Settings</h1>
                        <p class="text-muted mb-0">Manage your profile, preferences, and account security</p>
                    </div>
                    <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-1"></i>Back to Dashboard
                    </a>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Left Column - Profile & Account Info -->
            <div class="col-lg-8">
                <!-- Profile Information -->
                <div class="settings-card">
                    <div class="settings-header">
                        <h3 class="h4 mb-0">
                            <i class="bi bi-person me-2"></i>Profile Information
                        </h3>
                    </div>
                    <div class="settings-body">
                        <form method="post" action="{% url 'settings' %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_profile">
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="name" class="form-label">Full Name</label>
                                        <input type="text" class="form-control" id="name" name="name" 
                                               value="{{ user.name }}" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="email" class="form-label">Email Address</label>
                                        <input type="email" class="form-control" id="email" 
                                               value="{{ user.email }}" readonly 
                                               style="background-color: #f8fafc;">
                                        <small class="text-muted">Email cannot be changed</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="last_known_location" class="form-label">Location</label>
                                        <input type="text" class="form-control" id="last_known_location" 
                                               name="last_known_location" 
                                               value="{{ profile.last_known_location|default:'' }}"
                                               placeholder="e.g., New York, NY">
                                        <small class="text-muted">Used for weather-based recommendations</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="preferred_weather_unit" class="form-label">Temperature Unit</label>
                                        <select class="form-select" id="preferred_weather_unit" name="preferred_weather_unit">
                                            <option value="celsius" {% if profile.preferred_weather_unit == 'celsius' %}selected{% endif %}>Celsius (°C)</option>
                                            <option value="fahrenheit" {% if profile.preferred_weather_unit == 'fahrenheit' %}selected{% endif %}>Fahrenheit (°F)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="user_timezone" class="form-label">Timezone</label>
                                <select class="form-select" id="user_timezone" name="user_timezone">
                                    <option value="UTC" {% if profile.user_timezone == 'UTC' %}selected{% endif %}>UTC</option>
                                    <option value="America/New_York" {% if profile.user_timezone == 'America/New_York' %}selected{% endif %}>Eastern Time (ET)</option>
                                    <option value="America/Chicago" {% if profile.user_timezone == 'America/Chicago' %}selected{% endif %}>Central Time (CT)</option>
                                    <option value="America/Denver" {% if profile.user_timezone == 'America/Denver' %}selected{% endif %}>Mountain Time (MT)</option>
                                    <option value="America/Los_Angeles" {% if profile.user_timezone == 'America/Los_Angeles' %}selected{% endif %}>Pacific Time (PT)</option>
                                    <option value="Europe/London" {% if profile.user_timezone == 'Europe/London' %}selected{% endif %}>London (GMT)</option>
                                    <option value="Europe/Paris" {% if profile.user_timezone == 'Europe/Paris' %}selected{% endif %}>Paris (CET)</option>
                                    <option value="Asia/Tokyo" {% if profile.user_timezone == 'Asia/Tokyo' %}selected{% endif %}>Tokyo (JST)</option>
                                </select>
                            </div>
                            
                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-save">
                                    <i class="bi bi-check-lg me-1"></i>Update Profile
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Password Change -->
                <div class="settings-card">
                    <div class="settings-header">
                        <h3 class="h4 mb-0">
                            <i class="bi bi-shield-lock me-2"></i>Change Password
                        </h3>
                    </div>
                    <div class="settings-body">
                        <form method="post" action="{% url 'settings' %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="change_password">
                            
                            <div class="form-group">
                                <label for="current_password" class="form-label">Current Password</label>
                                <input type="password" class="form-control" id="current_password" 
                                       name="current_password" required>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="new_password" class="form-label">New Password</label>
                                        <input type="password" class="form-control" id="new_password" 
                                               name="new_password" required minlength="8">
                                        <div class="password-strength" id="password-strength"></div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="confirm_password" class="form-label">Confirm New Password</label>
                                        <input type="password" class="form-control" id="confirm_password" 
                                               name="confirm_password" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-save">
                                    <i class="bi bi-key me-1"></i>Change Password
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Style Preferences -->
                <div class="settings-card">
                    <div class="settings-header">
                        <h3 class="h4 mb-0">
                            <i class="bi bi-palette me-2"></i>Style Preferences
                        </h3>
                    </div>
                    <div class="settings-body">
                        <form method="post" action="{% url 'settings' %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_preferences">
                            
                            <div class="form-section">
                                <h5 class="section-title">
                                    <i class="bi bi-palette"></i>Favorite Colors
                                </h5>
                                <div class="checkbox-group">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_colors" value="red" id="color_red" {% if "red" in profile.style_prefs.favorite_colors %}checked{% endif %}>
                                        <label class="form-check-label" for="color_red">Red</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_colors" value="blue" id="color_blue" {% if "blue" in profile.style_prefs.favorite_colors %}checked{% endif %}>
                                        <label class="form-check-label" for="color_blue">Blue</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_colors" value="green" id="color_green" {% if "green" in profile.style_prefs.favorite_colors %}checked{% endif %}>
                                        <label class="form-check-label" for="color_green">Green</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_colors" value="yellow" id="color_yellow" {% if "yellow" in profile.style_prefs.favorite_colors %}checked{% endif %}>
                                        <label class="form-check-label" for="color_yellow">Yellow</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_colors" value="orange" id="color_orange" {% if "orange" in profile.style_prefs.favorite_colors %}checked{% endif %}>
                                        <label class="form-check-label" for="color_orange">Orange</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_colors" value="purple" id="color_purple" {% if "purple" in profile.style_prefs.favorite_colors %}checked{% endif %}>
                                        <label class="form-check-label" for="color_purple">Purple</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_colors" value="pink" id="color_pink" {% if "pink" in profile.style_prefs.favorite_colors %}checked{% endif %}>
                                        <label class="form-check-label" for="color_pink">Pink</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_colors" value="black" id="color_black" {% if "black" in profile.style_prefs.favorite_colors %}checked{% endif %}>
                                        <label class="form-check-label" for="color_black">Black</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_colors" value="white" id="color_white" {% if "white" in profile.style_prefs.favorite_colors %}checked{% endif %}>
                                        <label class="form-check-label" for="color_white">White</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_colors" value="gray" id="color_gray" {% if "gray" in profile.style_prefs.favorite_colors %}checked{% endif %}>
                                        <label class="form-check-label" for="color_gray">Gray</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_colors" value="brown" id="color_brown" {% if "brown" in profile.style_prefs.favorite_colors %}checked{% endif %}>
                                        <label class="form-check-label" for="color_brown">Brown</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h5 class="section-title">
                                    <i class="bi bi-star"></i>Favorite Styles
                                </h5>
                                <div class="checkbox-group">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_styles" value="casual" id="style_casual" {% if "casual" in profile.style_prefs.favorite_styles %}checked{% endif %}>
                                        <label class="form-check-label" for="style_casual">Casual</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_styles" value="formal" id="style_formal" {% if "formal" in profile.style_prefs.favorite_styles %}checked{% endif %}>
                                        <label class="form-check-label" for="style_formal">Formal</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_styles" value="business" id="style_business" {% if "business" in profile.style_prefs.favorite_styles %}checked{% endif %}>
                                        <label class="form-check-label" for="style_business">Business</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_styles" value="athletic" id="style_athletic" {% if "athletic" in profile.style_prefs.favorite_styles %}checked{% endif %}>
                                        <label class="form-check-label" for="style_athletic">Athletic</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_styles" value="bohemian" id="style_bohemian" {% if "bohemian" in profile.style_prefs.favorite_styles %}checked{% endif %}>
                                        <label class="form-check-label" for="style_bohemian">Bohemian</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_styles" value="minimalist" id="style_minimalist" {% if "minimalist" in profile.style_prefs.favorite_styles %}checked{% endif %}>
                                        <label class="form-check-label" for="style_minimalist">Minimalist</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_styles" value="vintage" id="style_vintage" {% if "vintage" in profile.style_prefs.favorite_styles %}checked{% endif %}>
                                        <label class="form-check-label" for="style_vintage">Vintage</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_styles" value="trendy" id="style_trendy" {% if "trendy" in profile.style_prefs.favorite_styles %}checked{% endif %}>
                                        <label class="form-check-label" for="style_trendy">Trendy</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_styles" value="classic" id="style_classic" {% if "classic" in profile.style_prefs.favorite_styles %}checked{% endif %}>
                                        <label class="form-check-label" for="style_classic">Classic</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_styles" value="edgy" id="style_edgy" {% if "edgy" in profile.style_prefs.favorite_styles %}checked{% endif %}>
                                        <label class="form-check-label" for="style_edgy">Edgy</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h5 class="section-title">
                                    <i class="bi bi-calendar-event"></i>Favorite Occasions
                                </h5>
                                <div class="checkbox-group">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_occasions" value="work" id="occasion_work" {% if "work" in profile.style_prefs.favorite_occasions %}checked{% endif %}>
                                        <label class="form-check-label" for="occasion_work">Work</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_occasions" value="party" id="occasion_party" {% if "party" in profile.style_prefs.favorite_occasions %}checked{% endif %}>
                                        <label class="form-check-label" for="occasion_party">Party</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_occasions" value="date" id="occasion_date" {% if "date" in profile.style_prefs.favorite_occasions %}checked{% endif %}>
                                        <label class="form-check-label" for="occasion_date">Date</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_occasions" value="travel" id="occasion_travel" {% if "travel" in profile.style_prefs.favorite_occasions %}checked{% endif %}>
                                        <label class="form-check-label" for="occasion_travel">Travel</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_occasions" value="exercise" id="occasion_exercise" {% if "exercise" in profile.style_prefs.favorite_occasions %}checked{% endif %}>
                                        <label class="form-check-label" for="occasion_exercise">Exercise</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_occasions" value="home" id="occasion_home" {% if "home" in profile.style_prefs.favorite_occasions %}checked{% endif %}>
                                        <label class="form-check-label" for="occasion_home">Home</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_occasions" value="shopping" id="occasion_shopping" {% if "shopping" in profile.style_prefs.favorite_occasions %}checked{% endif %}>
                                        <label class="form-check-label" for="occasion_shopping">Shopping</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_occasions" value="wedding" id="occasion_wedding" {% if "wedding" in profile.style_prefs.favorite_occasions %}checked{% endif %}>
                                        <label class="form-check-label" for="occasion_wedding">Wedding</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_occasions" value="interview" id="occasion_interview" {% if "interview" in profile.style_prefs.favorite_occasions %}checked{% endif %}>
                                        <label class="form-check-label" for="occasion_interview">Interview</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="favorite_occasions" value="night_out" id="occasion_night_out" {% if "night_out" in profile.style_prefs.favorite_occasions %}checked{% endif %}>
                                        <label class="form-check-label" for="occasion_night_out">Night Out</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="size_preference" class="form-label">Size Preference</label>
                                        <select class="form-select" id="size_preference" name="size_preference">
                                            <option value="">Select size preference</option>
                                            <option value="xs" {% if profile.style_prefs.size_preference == 'xs' %}selected{% endif %}>XS</option>
                                            <option value="s" {% if profile.style_prefs.size_preference == 's' %}selected{% endif %}>S</option>
                                            <option value="m" {% if profile.style_prefs.size_preference == 'm' %}selected{% endif %}>M</option>
                                            <option value="l" {% if profile.style_prefs.size_preference == 'l' %}selected{% endif %}>L</option>
                                            <option value="xl" {% if profile.style_prefs.size_preference == 'xl' %}selected{% endif %}>XL</option>
                                            <option value="xxl" {% if profile.style_prefs.size_preference == 'xxl' %}selected{% endif %}>XXL</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="comfort_level" class="form-label">Comfort Level</label>
                                        <select class="form-select" id="comfort_level" name="comfort_level">
                                            <option value="">Select comfort level</option>
                                            <option value="very_comfortable" {% if profile.style_prefs.comfort_level == 'very_comfortable' %}selected{% endif %}>Very Comfortable</option>
                                            <option value="comfortable" {% if profile.style_prefs.comfort_level == 'comfortable' %}selected{% endif %}>Comfortable</option>
                                            <option value="moderate" {% if profile.style_prefs.comfort_level == 'moderate' %}selected{% endif %}>Moderate</option>
                                            <option value="stylish" {% if profile.style_prefs.comfort_level == 'stylish' %}selected{% endif %}>Stylish</option>
                                            <option value="very_stylish" {% if profile.style_prefs.comfort_level == 'very_stylish' %}selected{% endif %}>Very Stylish</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-save">
                                    <i class="bi bi-heart me-1"></i>Update Preferences
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Right Column - Account Info & Privacy -->
            <div class="col-lg-4">
                <!-- Account Information -->
                <div class="settings-card">
                    <div class="settings-header">
                        <h3 class="h4 mb-0">
                            <i class="bi bi-info-circle me-2"></i>Account Information
                        </h3>
                    </div>
                    <div class="settings-body">
                        <div class="account-info">
                            <div class="info-item">
                                <span class="info-label">Account Status</span>
                                <span class="status-badge status-verified">Active</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Email Status</span>
                                {% if user.email_verified %}
                                    <span class="status-badge status-verified">Verified</span>
                                {% else %}
                                    <span class="status-badge status-unverified">Unverified</span>
                                {% endif %}
                            </div>
                            <div class="info-item">
                                <span class="info-label">Member Since</span>
                                <span class="info-value">{{ user.created_at|date:"M d, Y" }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Last Login</span>
                                <span class="info-value">
                                    {% if user.last_login %}
                                        {{ user.last_login|date:"M d, Y g:i A" }}
                                    {% else %}
                                        Never
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Privacy Settings -->
                <div class="settings-card">
                    <div class="settings-header">
                        <h3 class="h4 mb-0">
                            <i class="bi bi-shield-check me-2"></i>Privacy Settings
                        </h3>
                    </div>
                    <div class="settings-body">
                        <form method="post" action="{% url 'settings' %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_profile">
                            
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" 
                                       name="data_processing_consent" id="data_processing_consent"
                                       {% if profile.data_processing_consent %}checked{% endif %}>
                                <label class="form-check-label" for="data_processing_consent">
                                    Allow data processing for AI recommendations
                                </label>
                            </div>
                            
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" 
                                       name="marketing_emails_consent" id="marketing_emails_consent"
                                       {% if profile.marketing_emails_consent %}checked{% endif %}>
                                <label class="form-check-label" for="marketing_emails_consent">
                                    Receive marketing emails and updates
                                </label>
                            </div>
                            
                            <div class="d-flex justify-content-end mt-3">
                                <button type="submit" class="btn btn-save">
                                    <i class="bi bi-check-lg me-1"></i>Save Privacy Settings
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Password strength indicator
    const passwordInput = document.getElementById('new_password');
    const strengthIndicator = document.getElementById('password-strength');
    
    if (passwordInput && strengthIndicator) {
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            let strength = 0;
            let strengthText = '';
            
            if (password.length >= 8) strength++;
            if (password.match(/[a-z]/)) strength++;
            if (password.match(/[A-Z]/)) strength++;
            if (password.match(/[0-9]/)) strength++;
            if (password.match(/[^a-zA-Z0-9]/)) strength++;
            
            if (strength < 2) {
                strengthText = '<span class="strength-weak">Weak password</span>';
            } else if (strength < 4) {
                strengthText = '<span class="strength-medium">Medium strength</span>';
            } else {
                strengthText = '<span class="strength-strong">Strong password</span>';
            }
            
            strengthIndicator.innerHTML = strengthText;
        });
    }
    
    // Form validation
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const action = this.querySelector('input[name="action"]').value;
            
            if (action === 'change_password') {
                const newPassword = document.getElementById('new_password').value;
                const confirmPassword = document.getElementById('confirm_password').value;
                
                if (newPassword !== confirmPassword) {
                    e.preventDefault();
                    alert('New passwords do not match!');
                    return false;
                }
                
                if (newPassword.length < 8) {
                    e.preventDefault();
                    alert('Password must be at least 8 characters long!');
                    return false;
                }
            }
        });
    });
});
</script>
{% endblock %}
